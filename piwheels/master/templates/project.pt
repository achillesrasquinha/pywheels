<div metal:use-macro="layout">
  <div metal:fill-slot="title" tal:omit-tag="1">${project}</div>

  <div metal:fill-slot="head" tal:omit-tag="1">
    <link rel="canonical" href="https://www.piwheels.org/project/${project}/" />
    <meta name="description" content="The piwheels project page for ${project}: ${description}" />
  </div>

  <div metal:fill-slot="scripts" tal:omit-tag="1">
    <script src="/project.js"></script>
    <script>showDownloads('${package}');</script>
  </div>

  <div metal:fill-slot="content" tal:omit-tag="1">
    <section>
      <div class="content">
        <h2 id="package">${project}</h2>
        <p>${description}</p>

        <h3 id="install">Installation</h3>
        <pre tal:condition="dependencies">sudo apt install ${' '.join(dependencies)}
sudo pip3 install ${project}</pre>
        <pre tal:condition="not dependencies">sudo pip3 install ${project}</pre>
        <p><a href="/faq.html#sudo">Should I use sudo? pip or pip3?</a></p>
      </div>

      <div class="sidebar">
        <div class="stats highlight">
          <dl>
            <dt>PyPI page</dt>
            <dd><a href="https://pypi.org/project/${project}">pypi.org/<wbr />project/<wbr />${project}</a></dd>
          </dl>
          <dl>
            <dt>Project JSON</dt>
            <dd><a href="/project/${package}/json">piwheels.org/<wbr />project/<wbr />${package}/<wbr />json</a></dd>
          </dl>
          <dl>
            <dt>Versions</dt>
            <dd>${'{:,}'.format(len(releases))}</dd>
          </dl>
          <dl>
            <dt>Files</dt>
            <dd>${'{:,}'.format(num_files)}</dd>
          </dl>
          <dl>
            <dt>Downloads<wbr /> (all time)</dt>
            <dd id="downloads-all">loading...</dd>
          </dl>
          <dl>
            <dt>Downloads<wbr /> (last 30 days)</dt>
            <dd id="downloads-30">loading...</dd>
          </dl>
        </div>
      </div>
    </section>

    <section>
      <div class="content no-sidebar">
        <h3>Releases</h3>
        <table class="versions" tal:condition="releases">
          <thead>
            <tr>
              <th>Version</th>
              <th>Released</th>
              <th>Stretch<br />(Python 3.5)</th>
              <th>Buster<br />(Python 3.7)</th>
              <th>Bullseye<br />(Python 3.9)</th>
              <th>Files</th>
            </tr>
          </thead>
          <tbody>
            <span tal:repeat="row releases" tal:omit-tag="True">
              <tr>
                <td>
                  ${row.version.original}
                  <span tal:condition="row.version.is_prerelease" class="prerelease">pre-release</span>
                  <span tal:condition="row.yanked" class="yanked">yanked</span>
                </td>
                <td title="${row.released.strftime(
                             '%Y-%m-%d %H:%M:%S %Z')}">${row.released.strftime('%Y-%m-%d')}</td>
                <td class="${row.abis['cp35m'].css_class
                             if 'cp35m' in row.abis else None}"
                    title="${row.abis['cp35m'].title
                             if 'cp35m' in row.abis else None}"></td>
                <td class="${row.abis['cp37m'].css_class
                             if 'cp37m' in row.abis else None}"
                    title="${row.abis['cp37m'].title
                             if 'cp37m' in row.abis else None}"></td>
                <td class="${row.abis['cp39m'].css_class
                             if 'cp39m' in row.abis else None}"
                    title="${row.abis['cp39m'].title
                             if 'cp39m' in row.abis else None}"></td>
                <td></td>
              </tr>
              <tr>
                <td colspan="6">
                  <ul class="files">
                    <li tal:repeat="file row.files"
                       data-dependencies="${' '.join(file.apt_dependencies)}">
                      <span>
                        <a href="/simple/${package}/${file.filename}#sha256=${file.filehash}">${file.filename}</a>
                        (${format_size(file.filesize)})
                      </span>
                    </li>
                  </ul>
                </td>
              </tr>
            </span>
          </tbody>
        </table>
        <table tal:condition="not releases" class="empty">
          <tr><th>No releases</th></tr>
        </table>

        <h4>Key</h4>
        <table id="builds-key">
          <tr><td class="success"></td><td>Build succeeded</td></tr>
          <tr><td class="fail"></td><td>Build failed</td></tr>
          <tr><td class="skip"></td><td>Build skipped</td></tr>
          <tr><td class="pending"></td><td>Build pending</td></tr>
        </table>

        <h3>Issues with this package?</h3>
        <table class="package-issues">
          <tr><td>Check if there's an open issue</td><td><a class="button" id="search-btn" onclick="getIssues('${project}')">Search</a></td></tr>
          <tr><td>Package or version missing?</td><td><a class="button" href="https://github.com/piwheels/packages/issues/new?template=missing-package.yml&title=Missing+package:+${project}&labels=missing+package&package=${project}&pypi_url=https://pypi.org/project/${project}/&piwheels_url=https://www.piwheels.org/project/${project}/">New issue</a></td></tr>
          <tr><td>Something else?</td><td><a class="button" href="https://github.com/piwheels/packages/issues/new?template=package.yml&title=Missing+package:+${project}&labels=package+issue&package=${project}&pypi_url=https://pypi.org/project/${project}/&piwheels_url=https://www.piwheels.org/project/${project}/">New issue</a></td></tr>
        </table>
        <div id="issues"></div>

        <p><small>Page last updated ${timestamp}</small></p>
      </div>
    </section>
  </div>
</div>
